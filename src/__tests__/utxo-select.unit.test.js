import 'regenerator-runtime/runtime';

import mockFetch, {mockHeaders} from '../__mocks__/fetch';
import blockchain from '../blockchain';
import {utxoSelectNormal, utxoSelectCC} from '../utxo-select';

import blokchainMockJson from '../__mocks__/blockchain.json';

global.fetch = mockFetch;

blockchain.setFetch(mockFetch, mockHeaders);
blockchain.setExplorerUrl('');

it('should return utxoSelectNormal result (explorer API)', async() => {
  const res = await utxoSelectNormal(undefined, 10000);

  expect(res).toEqual({
    inputs:[
      {
        'address': 'RRF6ocq94kLpaH6wPdZjTqQa9mAmT1GToc',
        'txid': '6425a6153d1400db16b770e4f5043584db2c27be8ddac330b88d3aebae2b6060',
        'vout': 2,
        'scriptPubKey': '76a914af1cc72c9b5ef945424b03286dc255da59b6166888ac',
        'amount': 0.0001,
        'height': 127227,
        'confirmations': 61328,
        'value': 10000
      }
    ],
    outputs:[
      {
        'address': undefined,
        'value': 10000
      }
    ],
    'fee': 0
  });
});

it('should return utxoSelectNormal result in cclib format (explorer API)', async() => {
  const res = await utxoSelectNormal(undefined, 10000, true);

  expect(res).toEqual({
    txhex: '0400008085202f890160602baeeb3a8db830c3da8dbe272cdb843504f5e470b716db00143d15a625640200000000ffffffff0000000000000000000000000000000000000000',
    previousTxns: [
      '0400008085202f89021aa2569b63757170bdcfca7dad6f35c1aacf1ffa84f0ac8fb7135cbc59feab1c010000006a473044022057d5949ffe762aaf7dc34cc47747da25184fbebd08955517465609ce8bd66d4f02200cd05ece3a9f934a7a055f760092864d4269c48c4ad8239dffc3f34bb7421f0f012103256ba44eeb188404b94ae8ed64f1fe6ad89580375830845361e365598efa3ff3fffffffff225881a6c87c763ba9e1ead2c6443ffde50f7c7aaafa1a64e3f5422ece6723900000000804c7ea27ba077a26ba067a56580210345d2e7ab018619da6ed58ccc0138c5f58a7b754bd8e9a1a9d2b811c5fe72d4678140adbe24d5c51b66d5171e2cdd66d163e31892d5cb6986de7b437f7fe46f2e6b9a52c3271896634e79b6d0c00762bbd33f42263f3c2c2c43ba941eb934ede28f6ba100af038001f5af038001f6a10001ffffffff06010000000000000045434da240a00fa003800103af038001f5af038001f6a12da22b8020372291b16b9c8bab27def01f3d96e96f97f5ab14b1cab090dbe9296b70fd87bb810302040082020204cc01000000000000008d3e4da23ba00aa003800102af038001f5a12da22b8020ad8a7ea426938438ed75c3fe6443e30d72604543a8d49904d61a22ef663d8cfa810302040082020204cc4b0402f501012103256ba44eeb188404b94ae8ed64f1fe6ad89580375830845361e365598efa3ff323f57401d2b0f79bb123518103f2a3a808ca287b6c7ef80d0812e24e81dbcd7f5c5902487510270000000000001976a914af1cc72c9b5ef945424b03286dc255da59b6166888ac1027000000000000403e4da23ba00aa003800102af038001f6a12da22b80207ebf8ee1003c0a30b815944703592f70e8f7646b07ba97b754fa27553ed477f5810302080082020204cc70110100000000001976a914af1cc72c9b5ef945424b03286dc255da59b6166888ac0000000000000000586a4c55f57401d2b0f79bb123518103f2a3a808ca287b6c7ef80d0812e24e81dbcd7f5c59024831f6530110270000000000002103256ba44eeb188404b94ae8ed64f1fe6ad89580375830845361e365598efa3ff3478d020000000000c2f101000000000000000000000000'
    ],
  });
});

it('should return utxoSelectCC result (explorer API)', async() => {
  const res = await utxoSelectCC(undefined, undefined);

  expect(res).toEqual([
    {
      address: 'CaopajuemreFwEAfbywvFi8oFyrJPNkDs1',
      txid: '1cabfe59bc5c13b78facf084fa1fcfaac1356fad7dcacfbd707175639b56a21a',
      script: '3e4da23ba00aa003800102af038001f5a12da22b8020ad8a7ea426938438ed75c3fe6443e30d72604543a8d49904d61a22ef663d8cfa810302040082020204cc4b0402f501012103256ba44eeb188404b94ae8ed64f1fe6ad89580375830845361e365598efa3ff323f574017e2b623cb57b44b8dc5d3a3cc36c20d08f66023a85fa2a4490a8fb8783d3834775',
      satoshis: 1,
      height: 127206,
      confirmations: 61969,
      vout: 2,
      value: 1e-8,
      tokenId: '7e2b623cb57b44b8dc5d3a3cc36c20d08f66023a85fa2a4490a8fb8783d38347',
      hex: '0400008085202f8903db5cd8130543c080eb5ea9877d494aca5150dcb3d66d6a3d3fb2dbbc0caa9896020000006b483045022100940da498309af5f59eb52f7521152809bd5d66e8a2c78582ca11f5924102662f022030b5d92384eb815b54d7986e3bc94f54a03f5566e9fae61e589ce1963b1af540012103256ba44eeb188404b94ae8ed64f1fe6ad89580375830845361e365598efa3ff3ffffffffdb5cd8130543c080eb5ea9877d494aca5150dcb3d66d6a3d3fb2dbbc0caa9896000000007b4c79a276a072a26ba067a56580210345d2e7ab018619da6ed58ccc0138c5f58a7b754bd8e9a1a9d2b811c5fe72d467814066c89a567c667f93d67d83f2548f5699979fac9fe1098a50b340d25814eb509a2c8542e46a5e4c6b502349096c9f7c4d7a62f537e964c71fedfaedb88ddc21d3a100af038001f6a10001ffffffff4601f986e93853573ee5e5ee781f015e4c6ef7702c43c12fcf957243f559ed50000000007b4c79a276a072a26ba067a565802103256ba44eeb188404b94ae8ed64f1fe6ad89580375830845361e365598efa3ff38140da324bc95732b3c956a10903f1b1517a31f4dee52cc9cb26c426d133468b6ce65476b9ce8607aacf52916b7ff147084bc9306c171003eb4a9c7c048024cec3eca100af038001f5a10001ffffffff050000000000000000403e4da23ba00aa003800102af038001f6a12da22b8020372291b16b9c8bab27def01f3d96e96f97f5ab14b1cab090dbe9296b70fd87bb810302040082020204cca0860100000000001976a914af1cc72c9b5ef945424b03286dc255da59b6166888ac01000000000000008d3e4da23ba00aa003800102af038001f5a12da22b8020ad8a7ea426938438ed75c3fe6443e30d72604543a8d49904d61a22ef663d8cfa810302040082020204cc4b0402f501012103256ba44eeb188404b94ae8ed64f1fe6ad89580375830845361e365598efa3ff323f574017e2b623cb57b44b8dc5d3a3cc36c20d08f66023a85fa2a4490a8fb8783d3834775b53f8d00000000001976a914af1cc72c9b5ef945424b03286dc255da59b6166888ac0000000000000000586a4c55f574017e2b623cb57b44b8dc5d3a3cc36c20d08f66023a85fa2a4490a8fb8783d3834731f64201a0860100000000002103256ba44eeb188404b94ae8ed64f1fe6ad89580375830845361e365598efa3ff35c8d020000000000aef101000000000000000000000000'
    }
  ]);
});

it('should return utxoSelectCC result in cclib format (explorer API)', async() => {
  const res = await utxoSelectCC(undefined, undefined, true);

  expect(res).toEqual({
    txhex: '0400008085202f89011aa2569b63757170bdcfca7dad6f35c1aacf1ffa84f0ac8fb7135cbc59feab1c0200000000ffffffff0000000000000000000000000000000000000000',
    previousTxns: [
      '0400008085202f8903db5cd8130543c080eb5ea9877d494aca5150dcb3d66d6a3d3fb2dbbc0caa9896020000006b483045022100940da498309af5f59eb52f7521152809bd5d66e8a2c78582ca11f5924102662f022030b5d92384eb815b54d7986e3bc94f54a03f5566e9fae61e589ce1963b1af540012103256ba44eeb188404b94ae8ed64f1fe6ad89580375830845361e365598efa3ff3ffffffffdb5cd8130543c080eb5ea9877d494aca5150dcb3d66d6a3d3fb2dbbc0caa9896000000007b4c79a276a072a26ba067a56580210345d2e7ab018619da6ed58ccc0138c5f58a7b754bd8e9a1a9d2b811c5fe72d467814066c89a567c667f93d67d83f2548f5699979fac9fe1098a50b340d25814eb509a2c8542e46a5e4c6b502349096c9f7c4d7a62f537e964c71fedfaedb88ddc21d3a100af038001f6a10001ffffffff4601f986e93853573ee5e5ee781f015e4c6ef7702c43c12fcf957243f559ed50000000007b4c79a276a072a26ba067a565802103256ba44eeb188404b94ae8ed64f1fe6ad89580375830845361e365598efa3ff38140da324bc95732b3c956a10903f1b1517a31f4dee52cc9cb26c426d133468b6ce65476b9ce8607aacf52916b7ff147084bc9306c171003eb4a9c7c048024cec3eca100af038001f5a10001ffffffff050000000000000000403e4da23ba00aa003800102af038001f6a12da22b8020372291b16b9c8bab27def01f3d96e96f97f5ab14b1cab090dbe9296b70fd87bb810302040082020204cca0860100000000001976a914af1cc72c9b5ef945424b03286dc255da59b6166888ac01000000000000008d3e4da23ba00aa003800102af038001f5a12da22b8020ad8a7ea426938438ed75c3fe6443e30d72604543a8d49904d61a22ef663d8cfa810302040082020204cc4b0402f501012103256ba44eeb188404b94ae8ed64f1fe6ad89580375830845361e365598efa3ff323f574017e2b623cb57b44b8dc5d3a3cc36c20d08f66023a85fa2a4490a8fb8783d3834775b53f8d00000000001976a914af1cc72c9b5ef945424b03286dc255da59b6166888ac0000000000000000586a4c55f574017e2b623cb57b44b8dc5d3a3cc36c20d08f66023a85fa2a4490a8fb8783d3834731f64201a0860100000000002103256ba44eeb188404b94ae8ed64f1fe6ad89580375830845361e365598efa3ff35c8d020000000000aef101000000000000000000000000'
    ]
  });
});